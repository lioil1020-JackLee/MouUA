````markdown
# ModUA æ¨¹ç‹€çµæ§‹è§’è‰²æ¶æ§‹

**æ›´æ–°æ™‚é–“**: 2026å¹´2æœˆ2æ—¥  
**é©ç”¨ç‰ˆæœ¬**: ModUA v2.x

æœ¬æ–‡æª”æè¿° ModUA æ‡‰ç”¨ç¨‹å¼ä¸­æ¨¹ç‹€çµæ§‹ (QTreeWidget) å„ç¯€é»çš„æ•¸æ“šå­˜å„²æ ¼å¼å’Œè§’è‰²å®šç¾©ã€‚

## ğŸ“‹ é€šç”¨è¦å‰‡

### åŸºç¤è§’è‰²å®šç¾©
- **Column 0**: ç¯€é»é¡å‹ï¼ˆUserRoleï¼Œå€¼ç‚º `"Channel"/`"Device"/`"Group"/`"Tag" ç­‰ï¼‰
- **æ•¸æ“šå­˜å–**: æ‰€æœ‰æ•¸æ“šé€šé `item.data(column, role)` å­˜å–ï¼Œå…¶ä¸­ `role` ç‚º `Qt.ItemDataRole.UserRole`

## ğŸ—ï¸ ç¯€é»é¡å‹è©³è§£

### 1ï¸âƒ£ Channel ç¯€é»
**ç”¨é€”**: è¡¨ç¤ºé€šè¨Šé€šé“ï¼ŒåŒ…å«é©…å‹•é¡å‹å’Œç¶²è·¯åƒæ•¸

| Column | å­—æ®µåç¨± | æ•¸æ“šé¡å‹ | èªªæ˜ |
|--------|----------|----------|------|
| 0 | Node Type | `str` | å›ºå®šå€¼ `"Channel"` |
| 1 | Description | `str` | é »é“æè¿°æ–‡å­— |
| 2 | Driver | `dict`/`str` | é©…å‹•é…ç½®ï¼Œå¯ç‚ºå­—å…¸æˆ–å­—ä¸² |
| 3 | Communication | `dict` | æ‰å¹³é€šè¨Šåƒæ•¸å­—å…¸ |
| 9 | Full Driver | `OrderedDict` | å®Œæ•´é©…å‹•çµæ§‹ï¼ˆå‘å¾Œç›¸å®¹ï¼‰|

#### Driver å­—æ®µçµæ§‹
```python
# å­—å…¸æ ¼å¼
{
	"type": "Modbus TCP/IP Ethernet",
	"params": {
		# é©…å‹•ç‰¹å®šåƒæ•¸
	}
}

# å­—ä¸²æ ¼å¼ï¼ˆèˆŠç‰ˆç›¸å®¹ï¼‰
"Modbus TCP/IP Ethernet"
```

#### Communication å­—æ®µç¤ºä¾‹
```python
{
	"ip": "192.168.1.100",
	"port": 502,
	"adapter": "eth0",
	"com": "COM1",
	"baud": 9600,
	"data_bits": 8,
	"parity": "None",
	"stop": 1,
	"flow": "None"
}
```

### 2ï¸âƒ£ Device ç¯€é»
**ç”¨é€”**: è¡¨ç¤º Modbus è¨­å‚™ï¼ŒåŒ…å«å®šæ™‚å’Œç·¨ç¢¼åƒæ•¸

| Column | å­—æ®µåç¨± | æ•¸æ“šé¡å‹ | èªªæ˜ |
|--------|----------|----------|------|
| 0 | Node Type | `str` | å›ºå®šå€¼ `"Device"` |
| 1 | Description | `str` | è£ç½®æè¿°æ–‡å­— |
| 2 | Device ID | `int` | Modbus è¨­å‚™ç«™è™Ÿ/Unit ID |
| 3 | Timing | `dict` | è¦ç¯„åŒ–çš„å®šæ™‚åƒæ•¸ |
| 4 | Data Access | `dict` | æ•¸æ“šå­˜å–é…ç½® |
| 5 | Encoding | `dict` | ç·¨ç¢¼å’Œä½å…ƒçµ„é †åº |
| 6 | Block Sizes | `dict` | å€å¡Šå¤§å°é™åˆ¶ |

#### Timing å­—æ®µçµæ§‹
```python
{
	"connect_timeout": 1000,      # é€£æ¥è¶…æ™‚ (ms)
	"connect_attempts": 3,        # é€£æ¥å˜—è©¦æ¬¡æ•¸
	"request_timeout": 500,       # è«‹æ±‚è¶…æ™‚ (ms)
	"attempts_before_timeout": 2, # è¶…æ™‚å‰é‡è©¦æ¬¡æ•¸
	"inter_request_delay": 10     # è«‹æ±‚é–“å»¶é² (ms)
}
```

#### Data Access å­—æ®µçµæ§‹
```python
{
	"zero_based": 1,        # 0-based åœ°å€æ¨¡å¼
	"zero_based_bit": 0,    # ä½å…ƒçµ„ 0-based
	"bit_writes": 1,        # æ”¯æ´ä½å…ƒå¯«å…¥
	"func_06": 1,           # æ”¯æ´åŠŸèƒ½ç¢¼ 06
	"func_05": 1            # æ”¯æ´åŠŸèƒ½ç¢¼ 05
}
```

#### Encoding å­—æ®µçµæ§‹
```python
{
	"byte_order": 0,        # ä½å…ƒçµ„é †åº (0=Big Endian, 1=Little Endian)
	"word_order": 0,        # å­—çµ„é †åº
	"dword_order": 0,       # é›™å­—é †åº
	"bit_order": 0,         # ä½å…ƒé †åº
	"treat_longs_as_decimals": 0  # é•·æ•´æ•¸ä½œç‚ºåé€²åˆ¶
}
```

#### Block Sizes å­—æ®µçµæ§‹
```python
{
	"out_coils": 800,       # è¼¸å‡ºç·šåœˆå€å¡Šå¤§å°
	"in_coils": 800,        # è¼¸å…¥ç·šåœˆå€å¡Šå¤§å°
	"int_regs": 100,        # è¼¸å…¥æš«å­˜å™¨å€å¡Šå¤§å°
	"hold_regs": 100        # ä¿æŒæš«å­˜å™¨å€å¡Šå¤§å°
}
```

### 3ï¸âƒ£ Group ç¯€é»
**ç”¨é€”**: æ¨™ç±¤åˆ†çµ„çµ„ç¹”ï¼Œæ”¯æ´å±¤æ¬¡çµæ§‹

| Column | å­—æ®µåç¨± | æ•¸æ“šé¡å‹ | èªªæ˜ |
|--------|----------|----------|------|
| 0 | Node Type | `str` | å›ºå®šå€¼ `"Group"` |
| 1 | Description | `str` | ç¾¤çµ„æè¿°ï¼ˆå¯é¸ï¼‰ |

### 4ï¸âƒ£ Tag ç¯€é»
**ç”¨é€”**: Modbus æ•¸æ“šé»å®šç¾©ï¼ŒåŒ…å«åœ°å€ã€é¡å‹å’Œç¸®æ”¾ä¿¡æ¯

| Column | å­—æ®µåç¨± | æ•¸æ“šé¡å‹ | èªªæ˜ |
|--------|----------|----------|------|
| 0 | Node Type | `str` | å›ºå®šå€¼ `"Tag"` |
| 1 | Description | `str` | æ¨™ç±¤æè¿°æ–‡å­— |
| 2 | Data Type | `str` | æ•¸æ“šé¡å‹ï¼ˆWord, Boolean, Float, Arrayç­‰ï¼‰ |
| 3 | Client Access | `str` | å­˜å–æ¬Šé™ï¼ˆ"Read/Write" æˆ– "Read Only"ï¼‰ |
| 4 | Address | `str` | Modbus åœ°å€å­—ä¸² |
| 5 | Scan Rate | `int` | æƒæé€±æœŸï¼ˆæ¯«ç§’ï¼Œé è¨­ 10ï¼‰ |
| 6 | Scaling | `dict` | ç¸®æ”¾é…ç½®ï¼ˆå¯é¸ï¼‰ |
| 7 | Metadata | `dict` | æ§åˆ¶å™¨è¡ç”Ÿçš„å…ƒæ•¸æ“š |

#### Data Type å­—æ®µå€¼
- åŸºæœ¬é¡å‹: `"Word"`, `"Boolean"`, `"Float"`, `"Double"`, `"String"`
- é™£åˆ—é¡å‹: `"Word(Array)"`, `"Boolean(Array)"`, `"Float(Array)"` ç­‰

#### Scaling å­—æ®µçµæ§‹
```python
{
	"type": "linear",           # ç¸®æ”¾é¡å‹
	"raw_low": 0,               # åŸå§‹å€¼ä¸‹é™
	"raw_high": 1000,           # åŸå§‹å€¼ä¸Šé™
	"scaled_type": "float",     # ç¸®æ”¾å¾Œé¡å‹
	"scaled_low": 0.0,          # ç¸®æ”¾å¾Œä¸‹é™
	"scaled_high": 100.0,       # ç¸®æ”¾å¾Œä¸Šé™
	"clamp_low": true,          # ä¸‹é™å¤¾ç·Š
	"clamp_high": true,         # ä¸Šé™å¤¾ç·Š
	"negate": false,            # è² å€¼
	"units": "Â°C"               # å–®ä½
}
```

#### Metadata å­—æ®µçµæ§‹
```python
{
	"addrnum": 40001,        # è§£æå¾Œçš„åœ°å€æ•¸å­—
	"is_array": false,       # æ˜¯å¦ç‚ºé™£åˆ—
	"array_size": 1          # é™£åˆ—å¤§å°
}
```

## ğŸ”„ æ•¸æ“šæµèªªæ˜

### å‰µå»ºæµç¨‹
1. **ç”¨æˆ¶è¼¸å…¥** â†’ å°è©±æ¡†æ”¶é›†åƒæ•¸
2. **é©—è­‰è¦ç¯„åŒ–** â†’ `validators.py` è™•ç†
3. **çµæ§‹åŒ–å­˜å„²** â†’ æŒ‰ä¸Šè¿°æ ¼å¼å­˜å…¥ tree item roles
4. **æŒä¹…åŒ–** â†’ JSON åºåˆ—åŒ–ä¿å­˜

## ğŸ” è®€å–æµç¨‹
1. **æ¨¹éæ­·** â†’ `RuntimeMonitor._extract_all_tags()`
2. **é…ç½®æå–** â†’ å¾ roles è®€å–å„å­—æ®µ
3. **é©…å‹•åˆå§‹åŒ–** â†’ å»ºç«‹ ModbusClient/Worker
4. **æ•¸æ“šæ˜ å°„** â†’ `ModbusMapping` è™•ç†åœ°å€å’Œé¡å‹

## ğŸ“ é–‹ç™¼æ³¨æ„äº‹é …

### å‘å¾Œç›¸å®¹æ€§
- Column 9 çš„ "Full Driver" å­—æ®µä¿ç•™èˆŠç‰ˆæ ¼å¼æ”¯æŒ
- å­—ä¸²æ ¼å¼çš„ Driver å­—æ®µä»è¢«æ¥å—
- ç¼ºå¤±çš„å¯é¸å­—æ®µä¸æœƒå°è‡´å´©æ½°

### æ•¸æ“šå®Œæ•´æ€§
- æ‰€æœ‰å­—æ®µåœ¨ `base_controller.py` ä¸­æœ‰é©—è­‰é‚è¼¯
- è¦ç¯„åŒ–åœ¨ `config_builder.py` ä¸­è™•ç†
- é¡å‹è½‰æ›åœ¨ `validators.py` ä¸­åŸ·è¡Œ

### æ“´å±•æŒ‡å—
- æ–°ç¯€é»é¡å‹ï¼šæ·»åŠ å°æ‡‰çš„ role å®šç¾©
- æ–°å­—æ®µï¼šé¸æ“‡æœªä½¿ç”¨çš„ column ç·¨è™Ÿ
- å‘å¾Œç›¸å®¹ï¼šå§‹çµ‚æä¾›é»˜èªå€¼å’Œé·ç§»é‚è¼¯

---

**æ–‡æª”ç¶­è­·è€…**: AI Assistant  
**æœ€å¾Œæ›´æ–°**: 2026å¹´2æœˆ2æ—¥
````
